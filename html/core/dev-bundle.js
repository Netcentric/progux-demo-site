!function(){"use strict";const e=e=>0 in navigator?"unknown":e.indexOf(navigator.connection.effectiveType)>=0?"slow":"fast";var n={settings:{lowRAM:4,lowCPU:4,slowConnectionTypes:["slow-2g","2g","3g"]},sessionStorageKey:"progressiveUserSettings",sessionStorageDevKey:"progressiveUserDevSettings",defaultDevSettings:{isDraggable:1,mode:"closed",posTop:20,posLeft:20}};const t=Object.assign(n),o=e=>null!==sessionStorage.getItem(e),a=e=>{try{return o(e)?JSON.parse(sessionStorage.getItem(e)):{}}catch(e){console.log(e)}},s=(e,n)=>{l(e,n),function(e){const n=a(e),t=document.getElementsByTagName("html")[0];for(const[e,o]of Object.entries(n)){const n=`${e}-${o}`;t.classList.add(n)}}(n)},l=(e,n)=>{try{sessionStorage.setItem(n,JSON.stringify(e))}catch(e){console.log(e)}};const i=()=>{const{lowRAM:n,lowCPU:o,slowConnectionTypes:a}=t.settings;return{memoryLevel:(e=>{if(0 in navigator)return"unknown";const n=navigator.deviceMemory;return n===e?"mid":n>e?"high":"low"})(n),cpuLevel:(e=>{if(0 in navigator)return"unknown";const n=navigator.hardwareConcurrency;return n===e?"mid":n>e?"high":"low"})(o),connectionSpeed:e(a),saveData:"connection"in navigator?navigator.connection.saveData:0,reducedMotion:window.matchMedia("(prefers-reduced-motion: reduce)").matches,tracking:"doNotTrack"in navigator&&"1"===navigator.doNotTrack?"disabled":"enabled"}},c="settingsModal",d=c,r="settingsModal--open",u="settingsModal--closed",p="settingsModal--banner",g="settingsModal__header",m="settingsModal__title",v="settingsModal__form",f="settingsModal__submit",$="settingsModal__options",y="settingsModal__option",b="settingsModal__controller",h="settingsModal__controller--toggle",k="settingsModal__controller--options",w="settingsModal__controller--view",S="settingsModal__parameter",M="settingsModal__parameterValue",_="settingsModal__parameterInput",L="settingsModal__input",D="settingsModal__label",E="settingsModal__toggle",I="settingsModal__slider",T="settingsModal__closeIcon",V="settingsModal__openIcon",x={settingsModalSubmitId:"settingsModalSubmit",settingsModalFormId:"settingsModalForm"},O={title:"memory level",id:"settingsModalMemoryLevel",valuePrefix:"memory-level",options:[{type:"radio",id:"memory-level-low",name:"memoryLevel",value:"low",label:"low"},{type:"radio",id:"memory-level-mid",name:"memoryLevel",value:"mid",label:"mid"},{type:"radio",id:"memory-level-high",name:"memoryLevel",value:"high",label:"high"},{type:"radio",id:"memory-level-unknown",name:"memoryLevel",value:"unknown",label:"unknown"}]},q={title:"CPU level",id:"settingsModalCpuLevel",valuePrefix:"cpu-level",options:[{type:"radio",id:"cpu-level-low",name:"cpuLevel",value:"low",label:"low"},{type:"radio",id:"cpu-level-mid",name:"cpuLevel",value:"mid",label:"mid"},{type:"radio",id:"cpu-level-high",name:"cpuLevel",value:"high",label:"high"},{type:"radio",id:"cpu-level-unknown",name:"cpuLevel",value:"unknown",label:"unknown"}]},A={title:"Connection speed",id:"settingsModalConnectionSpeed",valuePrefix:"connection-speed",options:[{type:"radio",id:"connection-speed-slow",name:"connectionSpeed",value:"slow",label:"slow"},{type:"radio",id:"connection-speed-fast",name:"connectionSpeed",value:"fast",label:"fast"},{type:"radio",id:"connection-speed-unknown",name:"connectionSpeed",value:"unknown",label:"unknown"}]},j={title:"Save data",id:"saveData",name:"saveData",value:"true",checkedValue:"true",uncheckedValue:"false"},C={title:"Reduced motion",id:"reducedMotion",name:"reducedMotion",value:"true",checkedValue:"true",uncheckedValue:"false"},P={title:"Tracking",id:"tracking",name:"tracking",value:"enabled",checkedValue:"enabled",uncheckedValue:"disabled"},U={memoryLevel:O,cpuLevel:q,connectionSpeed:A},N={saveData:j,reducedMotion:C,tracking:P},K={title:"Banner view",id:"view",name:"view",value:"disabled",checkedValue:"enabled",uncheckedValue:"disabled"},B=e=>{const n=function(e){const{mode:n,posTop:t,posLeft:o,isDraggable:a}=e,s=`top: ${t}px; left: ${o}px;`;let l="closed"===n?d+"--closed":d+"--open";"banner"===n&&(l+=` ${d}--banner`);return`<div class="${d} ${l}"\n                 style="${s}"\n                 id="${d}" \n                 draggable="${a?"true":"false"}">`}(e),t=`<button type="submit" class="${f}" id="${x.settingsModalSubmitId}" value="Submit">Submit</button>`;return`${n}\n        ${`<div class="${g}">\n          <p class="${m}">Settings</p>\n          <span class="material-icons ${T}">\n            close\n          </span>\n          <span class="material-icons ${V}">\n            settings\n          </span>\n    </div>`}\n        ${`<form class="${v}" id="${x.settingsModalFormId}">`}\n        ${F(O)}\n        ${F(q)}\n        ${F(A)}\n        ${J(j)}\n        ${J(C)}\n        ${J(P)}\n        ${t}\n        </form>\n        ${function(e,n){return`<div class="${b} ${h} ${w}">\n        <p class="${S}">${e.title}</p>\n        <label class="${E}">\n            <input type="checkbox" \n                    id="${e.id}" \n                    class="${L}"\n                    name="${e.name}" \n                    value="${"banner"===n.mode?e.checkedValue:e.uncheckedValue}"\n                    data-checked-value="${e.checkedValue}"\n                    data-unchecked-value="${e.uncheckedValue}"\n                    ${"banner"===n.mode?"checked":""}>\n            <span class="${I}"></span>\n        </label>\n    </div>`}(K,e)}\n        </div>`};function F(e){const n=function(e){let n="";for(const t of e)n+=`<li class="${y}">\n            <input type="${t.type}" id="${t.id}" class="${L}" name="${t.name}" value="${t.value}">\n            <label for="${t.id}" class="${D}">${t.label}</label>\n        </li>`;return n}(e.options);return`<div class="${b} ${k}">\n        <p class="${S}">${e.title}</p>\n        <p class="${M}"></p>\n        <ul class="${$} ${_}" id="${e.id}">\n            ${n}\n        </ul>\n    </div>`}function J(e){return`<div class="${b} ${h}">\n        <p class="${S}">${e.title}</p>\n        <p class="${M}">${e.value}</p>\n        <label class="${E} ${_}">\n            <input type="checkbox" \n                     id="${e.id}" \n                     class="${L}"\n                     name="${e.name}" \n                     value="${e.value}"\n                     data-checked-value="${e.checkedValue}"\n                     data-unchecked-value="${e.uncheckedValue}">\n            <span class="${I}"></span>\n        </label>\n    </div>`}let R,H;function X(e){R=e.offsetX,H=e.offsetY,e.dataTransfer.setData("text/plain",e.target.id)}function Y(e){e.preventDefault()}const{sessionStorageKey:z,sessionStorageDevKey:G}=n;function Q(){try{const e=JSON.parse(sessionStorage.getItem(z));Object.keys(U).forEach(n=>{const t=U[n];!function(e,n){const t=[...document.querySelector("."+v).querySelectorAll(e)].find(e=>e.id===n);if(!t)return;t.setAttribute("checked","");const o=t.value,a=t.closest("."+b).querySelector("."+M);a&&(a.innerHTML=o)}(`#${t.id} input`,`${t.valuePrefix}-${e[n]}`)}),Object.keys(N).forEach(e=>function(e,n){try{const t=JSON.parse(sessionStorage.getItem(z)),o=document.querySelector("."+v).querySelector("#"+e),a=t[n];if(!["true","enabled"].includes(a))return;o.setAttribute("checked","checked")}catch(e){console.log("Unable to parse modal settings",e)}}(N[e].id,e))}catch(e){console.log("Unable to parse modal settings",e)}}function W(e){e.stopPropagation(),e.preventDefault();!function(e){"checked"===e.getAttribute("checked")?e.removeAttribute("checked","false"):e.setAttribute("checked","checked")}(e.target.parentElement.querySelector("input"))}function Z(e){const n=[...e],t=[...Object.keys(U),...Object.keys(N)],o=function(e){const n=window.location.search;if(!n)return;return n.replace("?","").split("&").map(e=>e.split("=")).filter(n=>!e.includes(n[0]))}(t),a=t.map(e=>n.find(n=>n[0]===e)||[e,N[e].uncheckedValue]);return[...o,...a].map(e=>`${e[0]}=${e[1]}`).join("&")}function ee(e){e.preventDefault();!function(e){const n=`${window.location.href.split("?")[0]}?${e}`;window.location.href=n}(Z(new FormData(document.getElementById(x.settingsModalFormId))))}function ne(e,n){const t=e.querySelector("."+V),o=e.querySelector("."+T),a=e.querySelector(`.${w} .${E}`);t.addEventListener("click",()=>function(e,n){e.classList.remove(""+u),e.classList.add(""+r),n.mode="open",l(n,G)}(e,n)),o.addEventListener("click",()=>function(e,n){e.classList.remove(""+r),e.classList.add(""+u),n.mode="closed",l(n,G)}(e,n)),a.addEventListener("click",t=>function(e,n,t){if(e.stopPropagation(),e.preventDefault(),"checked"===e.target.parentElement.querySelector("input").getAttribute("checked"))return n.classList.add(""+p),t.mode="banner",void l(t,G);n.classList.remove(""+p),t.mode="open",l(t,G)}(t,e,n))}function te(e,n){e.addEventListener("dragstart",X,0),document.body.addEventListener("dragover",Y,0),document.body.addEventListener("drop",e=>function(e,n,t){const o=e.dataTransfer.getData("text"),a=document.getElementById(o),s=e.pageX-R,i=e.pageY-H;var c,d,r;d=s,r=i,(c=a).style.top=r+"px",c.style.left=d+"px",n.posTop=i,n.posLeft=s,l(n,t),e.dataTransfer.clearData()}(e,n,G),0)}const oe=e=>{Q(),function(){const e=document.querySelectorAll("."+E),n=document.getElementById(x.settingsModalSubmitId);e.forEach(e=>{e.addEventListener("click",W)}),n.addEventListener("click",ee)}();const n=document.querySelector("."+d),{isDraggable:t}=e;ne(n,e),t&&te(n,e)},{sessionStorageKey:ae,sessionStorageDevKey:se,defaultDevSettings:le}=n;(()=>{const n=(()=>{const e=new URLSearchParams(window.location.search).entries(),n={};for(const t of e)n[t[0]]=t[1];return n})(),l=a(ae),c=a(se),d=o(ae)?(()=>{const{slowConnectionTypes:n}=t.settings;return{connectionSpeed:e(n)}})():i(),r=Object.assign(l,d,n);s(r,ae),window.addEventListener("load",()=>{const e=Object.keys(c).length?c:le;document.body.insertAdjacentHTML("afterbegin",B(e)),oe(e)})})()}();
